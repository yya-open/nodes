<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åˆ†äº«çš„å¤‡å¿˜å½•</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="wrap" style="max-width:860px;">
    <header class="top" style="justify-content:space-between;">
      <div class="brand">
        <div class="logo">ğŸ“</div>
        <div>
          <div class="name">åˆ†äº«çš„å¤‡å¿˜å½•</div>
          <div class="sub">åªè¯»æŸ¥çœ‹</div>
        </div>
      </div>
      <a class="btn" href="/" style="text-decoration:none; display:inline-flex; align-items:center;">è¿”å›ä¸»é¡µ</a>
    </header>

    <div class="card" style="padding:18px;">
      <div id="sTitle" style="font-size:20px; font-weight:700;"></div>
      <div id="sMeta" class="smallmuted" style="margin-top:6px;"></div>
      <div id="sTags" class="tags" style="margin-top:10px;"></div>
      <div id="sBody" style="white-space:pre-wrap; margin-top:14px; line-height:1.6;"></div>
      <div id="sMsg" class="smallmuted" style="margin-top:14px;"></div>
    </div>
  </div>

  <script>
    async function api(path){
      const res = await fetch(path, { headers: { "accept": "application/json" }});
      const data = (res.headers.get("content-type")||"").includes("application/json") ? await res.json() : await res.text();
      if(!res.ok){
        const msg = data && data.error ? data.error : (typeof data==="string" ? data : "è¯·æ±‚å¤±è´¥");
        throw new Error(msg);
      }
      return data;
    }

    function esc(s){ return String(s||""); }
    function fmt(t){
      if(!t) return "";
      try { return new Date(t).toLocaleString(); } catch { return String(t); }
    }

    (async () => {
      const code = (location.hash || "").replace(/^#/, "").trim();
      const elTitle = document.getElementById("sTitle");
      const elMeta = document.getElementById("sMeta");
      const elTags = document.getElementById("sTags");
      const elBody = document.getElementById("sBody");
      const elMsg = document.getElementById("sMsg");

      if(!code){
        elMsg.textContent = "ç¼ºå°‘åˆ†äº«ç ã€‚";
        return;
      }

      elMsg.textContent = "åŠ è½½ä¸­...";
      try{
        const r = await api("/api/share/" + encodeURIComponent(code));
        const n = r.note;
        elTitle.textContent = esc(n.title) || "ï¼ˆæ— æ ‡é¢˜ï¼‰";
        elBody.textContent = esc(n.body);
        elMeta.textContent = "æ›´æ–°ï¼š" + fmt(n.updatedAt) + (r.meta && r.meta.burned ? " Â· é˜…åå³ç„šé“¾æ¥ï¼ˆå·²å¤±æ•ˆï¼‰" : "");
        elTags.innerHTML = "";
        (n.tags || []).forEach(tag => {
          const span = document.createElement("span");
          span.className = "tag";
          span.textContent = tag;
          elTags.appendChild(span);
        });
        elMsg.textContent = r.meta && r.meta.burned ? "æ­¤é“¾æ¥å·²è‡ªåŠ¨å¤±æ•ˆï¼ˆé˜…åå³ç„šï¼‰ã€‚" : "";
      }catch(e){
        elMsg.textContent = "æ‰“å¼€å¤±è´¥ï¼š" + (e.message || e);
      }
    })();
  </script>
</body>
</html>
